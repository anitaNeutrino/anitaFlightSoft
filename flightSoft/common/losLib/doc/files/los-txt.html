<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>LOS telemetry library - liblos</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script></head><body class=UnframedPage onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.35 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<table border=0 cellspacing=0 cellpadding=0 width=100%><tr><td class=MenuSection valign=top><!--START_ND_MENU--><div class=MTitle>liblos<div class=MSubTitle>LOS telemetry library</div></div><div class=MEntry><div class=MFile id=MSelected>LOS telemetry library</div></div><div class=MEntry><div class=MFile><a href="los-h.html">los.h</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Index</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Files.html">Files</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Macros.html">Macros</a></div></div></div></div></div><!--END_ND_MENU--></td>

<td class=ContentSection valign=top><div class=CSection id=MainTopic><div class=CTopic><h1 class=CTitle><a name="LOS_telemetry_library"></a>LOS telemetry library</h1><div class=CBody><p class=CParagraph>Version 1.0</p><p class=CParagraph>General information.</p><p class=CParagraph>liblos is a library of C functions that takes care of transferring data via the LOS telemetry board designed by Paul Dowkontt of Washington U.&nbsp; The board is based on the PLX 9030.&nbsp; The kernel module supplied by PLX must be loaded into the kernel and the plx device file created.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr><td class=SEntrySize><div class=SMain><div class=SEntry><a href="#LOS_telemetry_library" >LOS telemetry library</a></div></div></td><td class=SDescriptionSize><div class=SMain><div class=SDescription>Version 1.0</div></div></td></tr><tr><td><div class=SSection><div class=SEntry><a href="#Compiling_and_installation" >Compiling and installation.</a></div></div></td><td><div class=SSection><div class=SDescription>Building the library and applications.</div></div></td></tr><tr><td><div class=SSection><div class=SEntry><a href="#Example_code" >Example code</a></div></div></td><td><div class=SSection><div class=SDescription>How do you do it?</div></div></td></tr><tr><td><div class=SSection><div class=SEntry><a href="#Data_format" >Data format</a></div></div></td><td><div class=SSection><div class=SDescription>Format of data sent to and received from the boards.</div></div></td></tr><tr><td><div class=SSection><div class=SEntry><a href="#Basic_lab_setup" >Basic lab setup</a></div></div></td><td><div class=SSection><div class=SDescription>Hardware and software details.</div></div></td></tr><tr><td><div class=SSection><div class=SEntry><a href="#Author" >Author</a></div></div></td><td><div class=SSection><div class=SDescription>Marty Olevitch</div></div></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class=CSection><div class=CTopic><h2 class=CTitle><a name="Compiling_and_installation"></a>Compiling and installation.</h2><div class=CBody><p class=CParagraph>Building the library and applications.</p><h4 class=CHeading>PLX libraries</h4><p class=CParagraph>The PLX libraries and header files are expected to be installed under /usr/local/PlxLinux.&nbsp; If this is not the case, edit the Makefile and change the PLX_SDK_DIR variable.</p><h4 class=CHeading>Compiling the library</h4><p class=CParagraph>To compile the library, run &ldquo;make&rdquo;.&nbsp; This should create liblos.a.</p><h4 class=CHeading>Compiling the demo program</h4><p class=CParagraph>To compile the demo program, run &ldquo;make demo&rdquo;.&nbsp; This should create a program called &ldquo;demo&rdquo;.</p><h4 class=CHeading>Installing the library</h4><p class=CParagraph>Run &ldquo;make install&rdquo;.</p><p class=CParagraph>By default, liblos will be installed in /pkgs/liblos-VERSION.&nbsp; If you don&rsquo;t like this, change the PREFIX variable.&nbsp; There is one for /usr/local that you can uncomment.&nbsp; The los.h header file will installed in $(PREFIX)/include and liblos.a in $(PREFIX)/lib when &ldquo;make install&rdquo; is run.</p><h4 class=CHeading>Compiling and linking an application</h4><p class=CParagraph>Try something like this:</p><blockquote><pre class=CCode>gcc -DGCC  -DPCI_CODE -DPLX_LITTLE_ENDIAN -DPLX_LINUX<br>-I/usr/local/PlxLinux/include<br>-I/usr/local/PlxLinux/linux/samples/common<br>-Wall -pipe -g -o myapp myapp.c -llos<br>/usr/local/PlxLinux/linux/api/Library/PlxApi.a<br>/usr/local/PlxLinux/linux/PciDrvApi/Library/PciDrvApi.a</pre></blockquote><p class=CParagraph>The relevant Makefile sections for the demo program would look like this.&nbsp; I know it&rsquo;s ugly.</p><blockquote><pre class=CCode>PLX_SDK_DIR = /usr/local/PlxLinux<br>COMMON_DIR = $(PLX_SDK_DIR)/linux/samples/common<br>INCLUDE_DIR = $(PLX_SDK_DIR)/include<br>INCLUDE = -I. -I$(INCLUDE_DIR) -I$(COMMON_DIR)<br><br>DEFS = -DGCC  -DPCI_CODE -DPLX_LITTLE_ENDIAN -DPLX_LINUX<br>OPTS = -Wall -pipe -g<br>CC = gcc<br>CFLAGS = $(DEFS) $(INCLUDE) $(OPTS)<br><br>LIBS = $(PLX_SDK_DIR)/linux/api/Library/PlxApi.a \<br>    $(PLX_SDK_DIR)/linux/PciDrvApi/Library/PciDrvApi.a<br><br>demo:   demo.c liblos.a los.h<br>    $(CC) $(CFLAGS) -o demo demo.c -llos $(LIBS) -lncurses</pre></blockquote></div></div></div>

<div class=CSection><div class=CTopic><h2 class=CTitle><a name="Example_code"></a>Example code</h2><div class=CBody><p class=CParagraph>How do you do it?</p><p class=CParagraph>See the file demo.c in the source distribution.&nbsp; It provides a simple interactive interface to the LOS board and should demonstrate how to exercise all the library functions.</p></div></div></div>

<div class=CSection><div class=CTopic><h2 class=CTitle><a name="Data_format"></a>Data format</h2><div class=CBody><p class=CParagraph>Format of data sent to and received from the boards.</p><h4 class=CHeading>Data sent to <a href="los-h.html#los_write" class=LFunction id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">los_write()</a></h4><p class=CParagraph>The only restriction that liblos imposes on the format of &ldquo;science&rdquo; data passed to it is that the number of bytes not exceed <a href="los-h.html#LOS_MAX_BYTES" class=LMacro id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">LOS_MAX_BYTES</a>, equal to 8100 bytes (as of 3 Aug &lsquo;05).&nbsp; Other than that, liblos treats the input science data as an arbitrary sequence of bytes.&nbsp; This sequence of bytes is transferred to an application on the ground embedded in a few headers as documented below.</p><h4 class=CHeading>Data returned by <a href="los-h.html#los_read" class=LFunction id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">los_read()</a></h4><p class=CParagraph>The data returned by <a href="los-h.html#los_read" class=LFunction id=link4 onMouseOver="ShowTip(event, 'tt3', 'link4')" onMouseOut="HideTip('tt3')">los_read()</a> has the following format.&nbsp; See also the <a href="los-h.html#Macros" class=LGroup >Macros</a> <a href="los-h.html#START_HDR" class=LMacro id=link5 onMouseOver="ShowTip(event, 'tt4', 'link5')" onMouseOut="HideTip('tt4')">START_HDR</a>, <a href="los-h.html#AUX_HDR" class=LMacro id=link6 onMouseOver="ShowTip(event, 'tt5', 'link6')" onMouseOut="HideTip('tt5')">AUX_HDR</a>, <a href="los-h.html#SW_START_HDR" class=LMacro id=link7 onMouseOver="ShowTip(event, 'tt6', 'link7')" onMouseOut="HideTip('tt6')">SW_START_HDR</a>, <a href="los-h.html#SW_END_HDR" class=LMacro id=link8 onMouseOver="ShowTip(event, 'tt7', 'link8')" onMouseOut="HideTip('tt7')">SW_END_HDR</a>, <a href="los-h.html#END_HDR" class=LMacro id=link9 onMouseOver="ShowTip(event, 'tt8', 'link9')" onMouseOut="HideTip('tt8')">END_HDR</a>, and <a href="los-h.html#AUX_HDR" class=LMacro id=link10 onMouseOver="ShowTip(event, 'tt5', 'link10')" onMouseOut="HideTip('tt5')">AUX_HDR</a>.</p><blockquote><pre class=CCode>byte    word<br>offset  offset     value   description<br><br> 0        0        0xF00D  START_HDR<br> 2        1        0xD0CC  AUX_HDR<br> 4        2        0xAE00  SW_START_HDR<br> 6        3                Buffer count<br> 8        4        N       Number of bytes of science data<br>10        5        NB      Science data (NB = N + (N%2) bytes).<br>...       ...                If N is an odd number, then a fill byte<br>...       ...                with value 0xDA is added to the end.<br>10+NB     5+(NB/2)         Checksum<br>12+NB     6+(NB/2) 0xAEFF  SW_END_HDR<br>14+NB     7+(NB/2) 0xC0FE  END_HDR<br>16+NB     8+(NB/2) 0xD0CC  AUX_HDR</pre></blockquote><p class=CParagraph>Regarding the number of science data bytes, if the number N is an odd number, then an additional byte <a href="los-h.html#FILL_BYTE" class=LMacro id=link11 onMouseOver="ShowTip(event, 'tt9', 'link11')" onMouseOut="HideTip('tt9')">FILL_BYTE</a> is added to the end.</p></div></div></div>

<div class=CSection><div class=CTopic><h2 class=CTitle><a name="Basic_lab_setup"></a>Basic lab setup</h2><div class=CBody><p class=CParagraph>Hardware and software details.</p><h4 class=CHeading>Hardware</h4><p class=CParagraph>Put the cPCI board in the flight computer.&nbsp; You will have to note which pci bus and slot it is in and pass these parameters to <a href="los-h.html#los_init" class=LFunction id=link12 onMouseOver="ShowTip(event, 'tt10', 'link12')" onMouseOut="HideTip('tt10')">los_init()</a>.</p><p class=CParagraph>Put the regular PCI board in the GSE computer.&nbsp; If this is the only PLX board in the computer, then you can give <a href="los-h.html#los_init" class=LFunction id=link13 onMouseOver="ShowTip(event, 'tt10', 'link13')" onMouseOut="HideTip('tt10')">los_init()</a> parameters of -1 for bus and slot, and the PLX driver will find the board.&nbsp; Otherwise, if there are other PLX boards, you will have to note the bus and slot as above.</p><p class=CParagraph>Connect the cable labeled &ldquo;DATA&rdquo; into the correspondingly labeled screw-in connector on the flight telemetry board.&nbsp; Do the same for the cable labeled &ldquo;CLK&rdquo;.</p><p class=CParagraph>Connect the DB9 connector into the GSE telemetry board.</p><h4 class=CHeading>Software</h4><p class=CParagraph>On the flight computer, run the demo program.&nbsp; It is an interactive program that allows you to the boards using the liblos routines.</p><ul class=CBulletList><li>press &ldquo;i&rdquo; to initialize liblos.&nbsp; It will prompt you for bus, slot, whether to use interrupts or polling, whether to write or read, and the number of milliseconds to delay between polls.</li></ul><p class=CParagraph>For now, use polling rather than interrupts, and leave the delay at the default of 100 ms by entering -1.&nbsp; The flight end should be set for writing.</p><ul class=CBulletList><li>press &ldquo;a&rdquo; to select the number of 16-bit words of data you want to transfer.</li><li>press &ldquo;W&rdquo; to write and transfer one buffer of data.</li><li>press &ldquo;w&rdquo; to continually transfer buffers.&nbsp; Another keypress will stop the transfers.</li></ul><p class=CParagraph>Do the same on the GSE computer, except set it to read mode instead of write, and</p><ul class=CBulletList><li>press &ldquo;R&rdquo; to read a single buffer.</li><li>press &ldquo;r&rdquo; to read continually.&nbsp; Another keypress will stop reading.</li></ul><p class=CParagraph>IMPORTANT: If things don&rsquo;t seem to be working, first try pressing the reset button on the board after power up.&nbsp; Eventually, we hope to have a software-activated reset.</p><p class=CParagraph>There is also a lower level interactive program called telem_test that I can send you if you think you need it.&nbsp; It does not use liblos, but does provide more direct access to the telemetry boards, and can be useful for debugging.</p></div></div></div>

<div class=CSection><div class=CTopic><h2 class=CTitle><a name="Author"></a>Author</h2><div class=CBody><p class=CParagraph>Marty Olevitch</p><p class=CParagraph>Physics Dept, Washington U in St Louis</p><p class=CParagraph>Tel: 314-935-6285</p><p class=CParagraph><a href="#" onClick="location.href='mai' + 'lto:' + 'ma' + 'rty' + '@' + 'cosray.w' + 'ustl.edu'; return false;" class=LEMail>ma<span style="display: none">.nosp@m.</span>rty<span>@</span>cosray.w<span style="display: none">.nosp@m.</span>ustl.edu</a></p><p class=CParagraph><a href="http://cosray.wustl.edu/~marty" class=LURL>http://cosray.wustl.edu/~marty</a></p></div></div></div>

</td>

</tr></table><div class=Footer><!--START_ND_FOOTER-->Copyright 2005 Martin A. Olevitch, Physics Dept, Washington University in St Louis, MO 63130.&nbsp; Generated by <a href="http://www.naturaldocs.org">Natural Docs</a>.<!--END_ND_FOOTER--></div>
<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>int los_write(</td><td class=PTypePrefix nowrap>unsigned&nbsp;</td><td class=PType nowrap>char&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>buf,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>short&nbsp;</td><td class=PParameterPrefix nowrap></td><td class=PParameter nowrap>nbytes</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Write data to the LOS telemetry board (and from there to the GSE). </div></div><div class=CToolTip id="tt2"><div class=CMacro>Maximum number of science bytes that can be handled by liblos. </div></div><div class=CToolTip id="tt3"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>int los_read(</td><td class=PTypePrefix nowrap>unsigned&nbsp;</td><td class=PType nowrap>char&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>buf,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>short&nbsp;</td><td class=PParameterPrefix nowrap>*</td><td class=PParameter nowrap>nbytes</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Read data from the LOS telemetry board. </div></div><div class=CToolTip id="tt4"><div class=CMacro>value 0xF00D</div></div><div class=CToolTip id="tt5"><div class=CMacro>value 0xD0CC</div></div><div class=CToolTip id="tt6"><div class=CMacro>value 0xAE00</div></div><div class=CToolTip id="tt7"><div class=CMacro>value 0xAEFF</div></div><div class=CToolTip id="tt8"><div class=CMacro>value 0xC0FE</div></div><div class=CToolTip id="tt9"><div class=CMacro>value 0xDA</div></div><div class=CToolTip id="tt10"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>int los_init(</td><td class=PTypePrefix nowrap>unsigned&nbsp;</td><td class=PType nowrap>char&nbsp;</td><td class=PParameter nowrap>bus,</td></tr><tr><td></td><td class=PTypePrefix nowrap>unsigned&nbsp;</td><td class=PType nowrap>char&nbsp;</td><td class=PParameter nowrap>slot,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>int&nbsp;</td><td class=PParameter nowrap>intr,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>int&nbsp;</td><td class=PParameter nowrap>wr,</td></tr><tr><td></td><td class=PTypePrefix nowrap></td><td class=PType nowrap>int&nbsp;</td><td class=PParameter nowrap>ms</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Initializes LOS telemetry communications.</div></div><!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>