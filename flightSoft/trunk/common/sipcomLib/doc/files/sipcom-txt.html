<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>&ldquo;SIP COMmuncation library&rdquo; - sipcom</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script></head><body class=UnframedPage onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.35 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<table border=0 cellspacing=0 cellpadding=0 width=100%><tr><td class=MenuSection valign=top><!--START_ND_MENU--><div class=MTitle>sipcom<div class=MSubTitle>SIP COMmunication library</div></div><div class=MEntry><div class=MFile id=MSelected>&ldquo;SIP COMmuncation library&rdquo;</div></div><div class=MEntry><div class=MFile><a href="sipcom-h.html">sipcom.h</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Index</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Files.html">Files</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Macros.html">Macros</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Types.html">Types</a></div></div></div></div></div><!--END_ND_MENU--></td>

<td class=ContentSection valign=top><div class=CSection id=MainTopic><div class=CTopic><h1 class=CTitle><a name="SIP_COMmuncation_library"></a>&ldquo;SIP COMmuncation library&rdquo;</h1><div class=CBody><p class=CParagraph>sipcom is a library of C functions that takes care of communicating with the Long Duration Balloon SIP package of the NSBF (<a href="http://www.nsbf.nasa.gov" class=LURL>http://www.nsbf.nasa.gov</a>).</p><h4 class=CHeading>We use the following SIP services</h4><ul class=CBulletList><li>transfers science commands from the ground</li><li>transfers ``high rate&rsquo;&rsquo; data from the science payload to the ground at rates up to 6000 bits/second via TDRSS.</li><li>transfers ``low rate&rsquo;&rsquo; data at a rate of 255 bytes every 30 seconds via TDRSS or Iridium.</li><li>provides GPS time, position, and pressure/altitude to the science payload.</li></ul><h4 class=CHeading>Cabling</h4><p class=CParagraph>Communicating with the SIP requires three (3) serial lines.</p><p class=CParagraph>When using the SIP simulator, each cable has a 9-pin RS-232 connector on each end.&nbsp; The pins are connected as in the diagram below.&nbsp; For the actual SIP, I am not sure.</p><blockquote><pre class=CCode>2 ___________    ___________ 2<br>             \  /<br>              \/<br>              /\<br>3 ___________/  \___________ 3<br><br>5 __________________________ 5</pre></blockquote><h4 class=CHeading>ANITA notes</h4><p class=CParagraph>The three serial lines are set up as follows</p><ul class=CBulletList><li>/dev/ttyS0 (com1) connects to SIP COMM1 port.</li><li>/dev/ttyS1 (com2) connects to SIP COMM2 port.</li><li>/dev/ttyS2 (com3) connects to SIP high rate TDRSS port.</li></ul><p class=CParagraph>On the ANITA SBS flight computer, the following command must be run at boot time.&nbsp; I put it in /etc/rc.local.&nbsp; It puts the third serial line at the correct IRQ.</p><blockquote><pre class=CCode>/bin/setserial /dev/ttyS2 irq 11</pre></blockquote><p class=CParagraph>Also, the bios settings must be changed on the &ldquo;peripheral setup&rdquo; page:</p><blockquote><pre class=CCode>Desc                    orig    now<br>OnBoard Serial Port 1   Auto    3F8h<br>&quot;       &quot;      &quot;    2   Auto    2F8h<br>&quot;       &quot;      &quot;    3   Auto    3E8h,IRQ11<br>&quot;       &quot;      &quot;    4   Auto    Auto</pre></blockquote><h4 class=CHeading>Callback functions</h4><p class=CParagraph>If you want to do anything when sipcom parses input from the SIP, you must provide callback functions.&nbsp; The callbacks are code that you provide, and that sipcom will execute whenever it parses</p><ul class=CBulletList><li>a command from the ground</li><li>a request for low-rate data</li><li>SIP gps position</li><li>SIP gps time</li><li>SIP altitude/pressure</li></ul><p class=CParagraph>If you do not provide a callback for a particular item, then sipcom will take no action when it encounters it.</p><h4 class=CHeading>Compiling</h4><p class=CParagraph>Since sipcom uses the pthreads library, you must link using -lpthread.</p><h4 class=CHeading>Example code</h4><p class=CParagraph>See the file driver.c in the source distribution.&nbsp; It should contain examples of all, I hope, functions in the library.</p><h4 class=CHeading>Data format for high-rate data</h4><blockquote><pre class=CCode> byte    length<br> offset  (bytes)  value    description<br> ------  ------   -----    -----------<br>    0       2     0xF00D   START_HDR<br>    2       2     0xD0CC   AUX_HDR<br>    4       2     0xAE0x   ID_HDR (See below)<br>    6       4     -        Sequential buffer count (32 bits)<br>   10       2     NB       Number of bytes of science data<br>   12      NB     -        Science data<br>   12+NB    2     -        Checksum (See below)<br>   14+NB    2     0xAEFF   SW_END_HDR<br>   16+NB    2     0xC0FE   END_HDR<br>   18+NB    2     0xD0CC   AUX_HDR<br><br> ID_HDR:<br>bit 0 = 0 LOS data<br>bit 0 = 1 SIP high-rate data<br><br>bit 1 = 0 Even number of science bytes.<br>bit 1 = 1 Odd number of science bytes. NB must be<br>    decremented and 0x00 pad byte at end of data removed.<br><br> Checksum calculated over the science bytes only; that is bytes<br>12 through (12+NB)-1.</pre></blockquote><h4 class=CHeading>Data format for low-rate data</h4><blockquote><pre class=CCode>byte    length<br>offset  (bytes)  value    description<br>------  ------   -----    -----------<br><br>   0       1     0xCn     Source (n=1 [COMM1] or n=2 [COMM2])<br>   1       1     -        Sequence number - cycles from 0 - 255<br>   2       1     NB       Number of data bytes that follow<br>   3      NB     -        Science data</pre></blockquote><p class=CParagraph>Note that there are separate sequence numbers for COMM1 and COMM2.&nbsp; In previous releases they shared the same sequence number.</p><h4 class=CHeading>Author</h4><p class=CParagraph>Marty Olevitch</p><p class=CParagraph>Physics Dept, Washington U in St Louis</p><p class=CParagraph>Tel: 314-935-6285</p><p class=CParagraph><a href="#" onClick="location.href='mai' + 'lto:' + 'ma' + 'rty' + '@' + 'cosray.w' + 'ustl.edu'; return false;" class=LEMail>ma<span style="display: none">.nosp@m.</span>rty<span>@</span>cosray.w<span style="display: none">.nosp@m.</span>ustl.edu</a></p><p class=CParagraph><a href="http://cosray.wustl.edu/~marty" class=LURL>http://cosray.wustl.edu/~marty</a></p></div></div></div>

</td>

</tr></table><div class=Footer><!--START_ND_FOOTER-->Copyright 2005 Martin A. Olevitch, Physics Dept, Washington University in St Louis, MO 63130.&nbsp; Generated by <a href="http://www.naturaldocs.org">Natural Docs</a>.<!--END_ND_FOOTER--></div>
<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>