


















                                    Acromag, Inc.
                                 30765 S.Wixom Road
                                    P.O. Box 437
                              Wixom, Michigan 48393-7037

                                Phone: (248)295-0310
                                 FAX: (248)624-9234

                               Linux Software Library
                         Information File for IOSCarrier Device
                                        V1.0
                                      04/01/09




               The  information  in this manual is subject to  change
               without notice.   Acromag,  Inc.  makes no warranty of
               any kind with regard to this material and accompanying
               software,  including, but not limited to , the implied
               warranties  of  merchantability  and  fitness  for   a
               particular   purpose.    Acromag,   Inc.   assumes  no
               responsibility for any errors that may appear in  this
               manual and accompanying software.

               See GPL and LGPL.txt.




























	Compiling and Loading the Device Driver Module

        i)   Copy the ioscarrier device driver routines from the "devios"
             directory of the source media to a new directory  under
             /home/ios/devios.
             Copy   the  carrier   support  routines  from  the
             "ioscarrier" directory  of the  source  media  to  a  new
             directory  under   /home/ios/ioscarrier. 

        ii)  IOS module interrupt service routines.
             Several IOS modules can generate an interrupt that can be used
             to indicate the competition of a data acquisition or some
             digital I/O or timer event.  Module ISRs files are found in
             the 'devios' directory using the naming convention iosXXXisr.c
             (where XXX is the model number).  If you plan to generate
             interrupts with the IOS modules a call to the iosXXXisr() must
             be placed into the 'ioscarrier_handler' function for the slot
             that corresponds to the IOS module.
             The 'ioscarrier_handler' function also contains comments and
             examples of how to add the iosXXXisr() function calls.
             The 'ioscarrier_handler' function is found in the file 'devios.c'.
             Any change to the 'devios.c' file requires the re-compilation of
             the device driver.  The ISR file ios52xisr() is used for both
             IOS520 and IOS521 modules.

        iii) Create device nodes for each carrier in the /dev directory using
             "mknod ioscarrier_0 c 48 0" 	(ioscarrier)
 
             The command line items are as follows:
             ioscarrier_0 - Device name minor number 0. 
             c       - Character device driver.
             48      - Major number defined in the device driver file.
             x       - Minor number 0.

             To create persistent device nodes for Acromag PCI board products.
             Edit your '/etc/rc.d/rc.local' as follows:
             #Acromag ioscarrier
             if [ ! -r /dev/ioscarrier_0 ]; then
             /bin/mknod -m 666 /dev/ioscarrier_0 c 48 0 #(ioscarrier)
             fi

             You may also need to change the permissions of the rc.local file.
             From a console use 'sudo nautilus --browser'
             Owner = root
             Group = root
             Execute = Allow executing as a program
             SELinux Context = initrc_exec_t

             or to to change the permissions from a root console
             chown root rc.local
             chown root:root rc.local
             chmod 777 rc.local

             You may also need to enable the rc-local service.
             From a console use 'sudo systemctl enable rc-local.service'.
             
        iv)  As 'root' use the makefile to build the project.

        v)   As 'root' load the module by using the insmod utility 
             "insmod /home/ios/devios/ioscarrier.ko".

        vi)  Go to one of the iosxxx module directories and see the infoxxx.txt
             file for information about compiling demonstration programs.

 
Note: If a "irq xxx: nobody cared" is reported when the board generates an interrupt, try
adding one of the following boot line options; "irqpoll", "acpi=off", or "pci=noacpi"
to the kernel boot line in file boot\grub\grub.conf (see below).

# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel /vmlinuz-version ro root=/dev/VolGroup00/LogVol00
#          initrd /initrd-version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title Fedora (2.6.21-1.3194.fc7)
	root (hd0,0)
	kernel /vmlinuz-2.6.21-1.3194.fc7 ro root=/dev/VolGroup00/LogVol00 rhgb quiet irqpoll
	initrd /initrd-2.6.21-1.3194.fc7.img
